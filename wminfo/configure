#!/bin/bash

# configure prepares Makefile for wminfo 2.5.2
# Copyright (C) 2011 Cezary M. Kruk <c.kruk@bigfoot.com>

version=2.5.2

if [ "$1" == "-h" -o "$1" == "--help" ]
then
cat << EOF
\`configure' configures wminfo $version.

Usage: ./configure [OPTION]

Configuration:
  -h, --help              displays this help and exits

Installation directory:
  --prefix=PREFIX         installs architecture-independent files in PREFIX
                          default is: /usr/local
                          allowed is: /usr
EOF
exit
else
if [ "`echo $1 | grep '\-\-prefix='`" != "" ]
then
    PREFIX=`echo $1 | sed 's/--prefix=//'`
fi
if [ "$PREFIX" == "" ]
then
    PREFIX=/usr/local
fi

FILE=Makefile

> $FILE
echo PREFIX=$PREFIX >> $FILE
echo PACKAGE=wminfo-$version >> $FILE
echo >> $FILE
echo BINDIR=\$\(PREFIX\)/bin >> $FILE
echo DOCDIR=\$\(PREFIX\)/doc/\$\(PACKAGE\) >> $FILE
echo MANDIR=\$\(PREFIX\)/man/man1 >> $FILE
echo >> $FILE
cat >> $FILE <<EOF
LIBDIR = -L/usr/X11R6/lib
LIBS   = -lXpm -lXext -lX11
FLAGS = -O2
OBJS =	wminfo.o \\
		../wmgeneral/wmgeneral.o \\
		../wmgeneral/misc.o \\
		../wmgeneral/list.o

.c.o:
	cc -I/usr/X11R6/share/include \$(FLAGS) -c -Wall \$< -o \$*.o

wminfo: \$(OBJS)
	cc \$(FLAGS) -o wminfo \$^ -lXext \$(LIBDIR) \$(LIBS)

all: wminfo

clean:
	for i in \$(OBJS) ; do \\
		rm -f \$\$i ; \\
	done
	rm -f wminfo
	rm -f *~
	rm -f core
	rm -f Makefile

install: wminfo
	cp -p wminfo \$(BINDIR)/
	chmod 755 \$(BINDIR)/wminfo
	chown root:root \$(BINDIR)/wminfo
	cp -p ../contrib/cp1250-up2low ../contrib/cp1251-up2low ../contrib/default.wmi ../contrib/empty.wmi ../contrib/html-iso1 ../contrib/iso1-up2low ../contrib/iso1-utf8 ../contrib/iso2-up2low ../contrib/iso2-utf8 ../contrib/iso5-up2low ../contrib/iso5-utf8 ../contrib/koi8r-up2low ../contrib/plugin ../contrib/punctuation ../contrib/suspend ../contrib/up2low ../contrib/utf8-iso1 ../contrib/utf8-iso2 ../contrib/utf8-iso5 ../contrib/utf8-up2low \$(BINDIR)/
	if [ ! -d \$(MANDIR) ]; then mkdir -p \$(MANDIR); fi
	cp -p ../doc/wminfo.1 \$(MANDIR)
	if [ ! -d \$(DOCDIR) ]; then mkdir \$(DOCDIR); fi
	cp -p ../COPYING ../ChangeLog ../INSTALL ../Plugins-HOWTO ../README ../README.Privacy ../TODO \$(DOCDIR)
	if [ ! -d \$(DOCDIR)/contrib ]; then mkdir \$(DOCDIR)/contrib; fi
	cp -p ../contrib/* \$(DOCDIR)/contrib
	if [ ! -d \$(DOCDIR)/plugins.conky ]; then mkdir \$(DOCDIR)/plugins.conky; fi
	cp -p ../plugins.conky/* \$(DOCDIR)/plugins.conky
	if [ ! -d \$(DOCDIR)/plugins.offline ]; then mkdir \$(DOCDIR)/plugins.offline; fi
	cp -p ../plugins.offline/* \$(DOCDIR)/plugins.offline
	if [ ! -d \$(DOCDIR)/plugins.online ]; then mkdir \$(DOCDIR)/plugins.online; fi
	cp -p ../plugins.online/* \$(DOCDIR)/plugins.online
	if [ ! -d \$(DOCDIR)/plugins.system ]; then mkdir \$(DOCDIR)/plugins.system; fi
	cp -p ../plugins.system/* \$(DOCDIR)/plugins.system
	if [ ! -d \$(DOCDIR)/samples ]; then mkdir \$(DOCDIR)/samples; fi
	cp -p ../samples/* \$(DOCDIR)/samples

uninstall:
	rm -f \$(BINDIR)/wminfo
	rm -f \$(BINDIR)/cp1250-up2low
	rm -f \$(BINDIR)/cp1251-up2low
	rm -f \$(BINDIR)/default.wmi
	rm -f \$(BINDIR)/empty.wmi
	rm -f \$(BINDIR)/html-iso1
	rm -f \$(BINDIR)/iso1-up2low
	rm -f \$(BINDIR)/iso1-utf8
	rm -f \$(BINDIR)/iso2-up2low
	rm -f \$(BINDIR)/iso2-utf8
	rm -f \$(BINDIR)/iso5-up2low
	rm -f \$(BINDIR)/iso5-utf8
	rm -f \$(BINDIR)/koi8r-up2low
	rm -f \$(BINDIR)/plugin
	rm -f \$(BINDIR)/punctuation
	rm -f \$(BINDIR)/suspend
	rm -f \$(BINDIR)/up2low
	rm -f \$(BINDIR)/utf8-iso1
	rm -f \$(BINDIR)/utf8-iso2
	rm -f \$(BINDIR)/utf8-iso5
	rm -f \$(BINDIR)/utf8-up2low
	rm -f \$(MANDIR)/wminfo.1
	rm -f \$(DOCDIR)/contrib/* \$(DOCDIR)/plugins.conky/* \$(DOCDIR)/plugins.offline/* \$(DOCDIR)/plugins.online/* \$(DOCDIR)/plugins.system/* \$(DOCDIR)/samples/*
	if [ -d \$(DOCDIR)/contrib ]; then rmdir \$(DOCDIR)/contrib; fi
	if [ -d \$(DOCDIR)/plugins.conky ]; then rmdir \$(DOCDIR)/plugins.conky; fi
	if [ -d \$(DOCDIR)/plugins.offline ]; then rmdir \$(DOCDIR)/plugins.offline; fi
	if [ -d \$(DOCDIR)/plugins.online ]; then rmdir \$(DOCDIR)/plugins.online; fi
	if [ -d \$(DOCDIR)/plugins.system ]; then rmdir \$(DOCDIR)/plugins.system; fi
	if [ -d \$(DOCDIR)/samples ]; then rmdir \$(DOCDIR)/samples; fi
	rm -f \$(DOCDIR)/*
	if [ -d \$(DOCDIR) ]; then rmdir \$(DOCDIR); fi
EOF
fi

